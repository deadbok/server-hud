<!DOCTYPE html>
<html lang="en">
	<head>
    	<meta charset="utf-8">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	    {% if hostname %}
	    	<title>{{ hostname }} - server HUD</title>
	    {% else %}
	        <title>Unknown hostname - server HUD</title>
	    {% endif %}
	    <link href="/static/css/dashboard.css" rel="stylesheet">
	    <meta http-equiv="refresh" content="30">
  	</head>
	<body>
		<div class="header"><div class="text-center" id="clock">Server dashboard - {{ hostname }} - 00:00</div></div>
		<div class="web-panel">
			<div class="connections">
	 			<div class="panel-heading">Active connections</div>
				<div class="panel-body"><h1 class="text-center high" id="connections">{{ active }}</h1></div>
			</div>
			<div class="url">
				<div class="panel-heading">Latest remote address</div>
				<div class="panel-body"><h3 class="text-center">{{ url }}</h3></div>
			</div>
			<div class="uptime">
				<div class="panel-heading">Uptime</div>
				<div class="panel-body"><h3 class="text-center">{{ uptime }}</h3></div>
			</div>
			<div class="accesses">
				<div class="panel-heading">Logged accesses</div>
				<div class="panel-body"><h3 class="text-center">{{ accesses }}</h3></div>
			</div>
		</div>
		<div class="speed-panel">
			<div class="rcv_speed">
				<div class="panel-heading">Receive speed</div>
				<div class="panel-body"><h3 class="text-center" id="rcv_speed"></h3></div>
			</div>
			<div class="send_speed">
				<div class="panel-heading">Send speed</div>
				<div class="panel-body"><h3 class="text-center" id="send_speed"></h3></div>
			</div>
		</div>

		<script src="static/js/atomic.js" type="text/javascript"></script>
		<script type="text/javascript">
var connections = document.getElementById("connections");
var rcv_speed = document.getElementById("rcv_speed");
var send_speed = document.getElementById("send_speed");

atomic.get('/rest/connections', 'application/json')
.success(function (data, xhr) 
{
	connections.innerHTML = data.connections;
})
.error(function (data, xhr) 
{
	connections.innerHTML = "Could not get data.";
	connections.className = "error";
});

atomic.get('/rest/recieve_speed', 'application/json')
.success(function (data, xhr) 
{
	rcv_speed.innerHTML = data.speed;
})
.error(function (data, xhr) 
{
	rcv_speed.innerHTML = "Could not get data.";
	rcv_speed.className = "error";
});

atomic.get('/rest/send_speed', 'application/json')
.success(function (data, xhr) 
{
	send_speed.innerHTML = data.speed;
})
.error(function (data, xhr) 
{
	send_speed.innerHTML = "Could not get data.";
	send_speed.className = "error";
});

function checkTime(i)
{
    if (i<10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
}

var today=new Date();
var h=today.getHours();
var m=today.getMinutes();
var s=today.getSeconds();
m = checkTime(m);
document.getElementById('clock').innerHTML = "Server dashboard - {{ hostname }} - " + h + ":" + m;
		</script>
	</body>
</html>